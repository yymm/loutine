# 最終決定: 方針B - 段階的リリース戦略

**決定日**: 2026-02-17

## 採用した方針

**方針B: 無料版先行リリース（段階的実装）**

---

## リリース計画

### 📦 v1.0 無料版リリース
- **時期**: Phase 2完了時点（約7週間 = 2ヶ月弱）
- **内容**: ローカルDB（Drift）のみ、認証なし
- **機能**: 既存の全機能（Link、Note、Purchase、Tag、Category）
- **制約**: 
  - 機種変更時のデータ移行不可
  - 複数デバイス同期不可
  - アプリ内で「v2.0で認証・課金機能追加予定」と告知

### 📦 v2.0 課金版リリース
- **時期**: Phase 6完了時点（約20週間 = 5ヶ月）
- **内容**: Google認証 + Sign in with Apple、課金機能、サーバー同期
- **機能**: v1.0の全機能 + 認証・課金・同期
- **移行**: v1.0ユーザーのローカルデータを自動的にサーバーにアップロード

---

## この方針を選んだ理由

### ✅ メリット

1. **早期リリース**
   - 7週間で市場に投入できる
   - ユーザーフィードバックを早く得られる

2. **審査リスク回避**
   - v1.0は認証機能なし → Sign in with Apple不要
   - App Store審査を確実に通過

3. **段階的な開発**
   - Phase 1-2に集中できる
   - v1.0リリース後にPhase 3以降の詳細設計

4. **市場での存在感**
   - 競合より早くリリース可能
   - v2.0へのアップグレードでユーザー維持

### ⚠️ デメリットと対策

| デメリット | 対策 |
|-----------|------|
| 機種変更でデータ消失 | アプリ内で「v2.0で対応予定」と明記 |
| v1.0→v2.0の移行フロー必要 | Phase 3でシームレスな移行機能を実装 |
| 課金機能が遅れる | v1.0で広告表示（オプション）で一部収益化 |

---

## 実装スケジュール

| Phase | 期間 | 完了予定 | 成果物 |
|-------|------|---------|--------|
| Phase 0 | 1-2週間 | Week 2 | 技術調査・設計 |
| Phase 1 | 2-3週間 | Week 5 | ローカルDB実装 |
| Phase 2 | 2週間 | Week 7 | Repository抽象化 → **v1.0リリース** |
| - | - | - | **ここでユーザーフィードバック取得** |
| Phase 3 | 3-4週間 | Week 11 | Google + Apple認証 |
| Phase 4 | 2-3週間 | Week 14 | 課金機能 |
| Phase 5 | 3-4週間 | Week 18 | 同期機能 |
| Phase 6 | 2週間 | Week 20 | 統合テスト → **v2.0リリース** |

---

## Phase 3での重要な変更

### 認証戦略: Google + Sign in with Apple 両対応

**理由:**
- v2.0ではApp Store審査でSign in with Appleが必須
- 最初から両対応することで審査リスク回避

**実装:**
```dart
// ログイン画面
Column(
  children: [
    // iOS: Sign in with Appleを上に配置
    if (Platform.isIOS)
      SignInWithAppleButton(
        onPressed: () => authService.signInWithApple(),
      ),
    
    // Google認証
    GoogleSignInButton(
      onPressed: () => authService.signInWithGoogle(),
    ),
  ],
)
```

**追加コスト:**
- Phase 3が2-3週間 → 3-4週間（+1週間）
- Firebase Auth統合により簡素化

---

## v1.0での告知内容

### アプリストアの説明文

```
【現在の機能】
- リンク、ノート、購入履歴の管理
- ローカルデータベースによる高速動作
- オフラインで完全に利用可能

【v2.0で追加予定（2026年夏）】
- アカウント機能（Google / Apple IDでログイン）
- 機種変更時のデータ自動復元
- 複数デバイス間でのデータ同期
- プレミアム機能（課金）

※現在は無料で全機能をご利用いただけます
※v2.0リリース時、既存データは自動的に移行されます
```

### アプリ内のバナー

```
💡 お知らせ
v2.0で認証・同期機能を追加予定！
機種変更やデバイス間同期に対応します。
現在のデータは自動的に移行されますのでご安心ください。
```

---

## v1.0→v2.0の移行フロー

### ユーザー体験

```
[v1.0ユーザー]
  ↓ v2.0にアップデート
[初回起動時のプロンプト]
「アカウントを作成してデータをバックアップしますか？」
  - ログインする（Google / Apple ID）
  - 後で（引き続きローカルのみ使用）
  ↓ ログインを選択
[認証完了]
  ↓ バックグラウンドで処理
[ローカルデータを自動的にサーバーにアップロード]
  ↓
[完了通知]
「データのバックアップが完了しました！
今後は機種変更しても自動的にデータが復元されます。」
```

### 技術実装

```dart
// v2.0初回起動時
if (await isFirstTimeV2User()) {
  final shouldMigrate = await showDialog(
    context: context,
    builder: (_) => MigrationDialog(),
  );
  
  if (shouldMigrate) {
    // 認証
    final user = await authService.signIn();
    
    // ローカルデータ取得
    final localData = await localDb.getAllData();
    
    // サーバーにアップロード
    await remoteRepository.uploadData(user.id, localData);
    
    // 完了通知
    showDialog(context: context, builder: (_) => MigrationCompleteDialog());
  }
}
```

---

## リスクと対策

### リスク1: v1.0ユーザーが機種変更でデータ消失

**対策:**
- アプリ内で明確に告知
- v2.0リリースを早める（Phase 3以降を加速）
- v1.0の配信期間を3-4ヶ月に抑える

### リスク2: v1.0→v2.0の移行が複雑

**対策:**
- Phase 3で移行フローを最優先で実装
- ユーザーテストを十分に実施
- ロールバック機能を用意

### リスク3: v1.0での収益化なし

**対策:**
- 広告表示（オプション）
- v2.0のベータテスター募集で関心維持
- 早期アクセスプログラム（Phase 5完了時点）

---

## 成功指標

### v1.0リリース時
- App Store/Play Store審査を1週間以内に通過
- 初月100ユーザー獲得
- クラッシュ率 < 1%
- ユーザーレビュー平均 > 4.0

### v2.0リリース時
- v1.0ユーザーの70%以上がv2.0にアップグレード
- データ移行成功率 > 95%
- 課金ユーザー転換率 > 5%
- ユーザーレビュー平均 > 4.5

---

## 次のアクション

1. ✅ 方針決定（完了）
2. ✅ ドキュメント修正（完了）
3. Phase 0の技術調査開始
4. v1.0向けの詳細設計
5. Phase 1のタスク分解とissue作成
6. 開発開始 🚀

---

## 関連ドキュメント

- [実装計画全体](./2026-02-17-auth-billing-migration-plan.md)
- [Phase順序の理由](./2026-02-17-phase-ordering-rationale.md)
- [iOS認証戦略](./2026-02-17-ios-auth-billing-strategy.md)
- [Google認証の目的](./2026-02-17-google-auth-purposes.md)
