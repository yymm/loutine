# Flutter and Dependencies Upgrade Strategy

## 背景

Flutter 3.38.5 および依存関係のアップデートを実施する際、特にRiverpodのメジャーバージョンアップ（2.x → 3.x）の影響が大きいことが判明した。

### 現状の課題

- テストカバレッジが極めて低い（テストファイル1個 vs ソースファイル48個）
- Riverpodに関する知識が不足しており、変更の妥当性判断が困難
- テストが貧弱なため、依存関係のアップデートやリファクタリング時にランタイムエラーを捕捉できない

## 段階的アプローチ

一度にすべてをアップデートするのではなく、以下の3段階で進める。

### Phase 1: Riverpod以外の依存関係アップデート

**目的**: Riverpodの影響を切り離し、他の依存関係を安全にアップデートする

**実施内容**:
- 新しいブランチ `feature/upgrade-deps-without-riverpod` を作成
- `pubspec.yaml` でRiverpodを現行バージョンに固定
- Flutter SDKおよびRiverpod以外のパッケージをアップデート
- 動作確認・テスト実行
- mainにマージ

### Phase 2: テスト拡充

**目的**: Riverpodアップデート時のリグレッションを検出できるようにする

**実施内容**:
- Riverpodに依存する主要な状態管理ロジックのテストを追加
  - 特に重要: `RoutineProvider`, `AuthProvider` などのコアProviders
  - ユースケース層のテスト
  - 統合テスト（必要に応じて）
- テストカバレッジの向上
- mainにマージ

### Phase 3: Riverpodアップデート

**目的**: テストでカバーされた状態で安全にRiverpod 3.xへ移行

**実施内容**:
- 新しいブランチ `feature/upgrade-riverpod` を作成
- Riverpod 3.xへアップデート
- Breaking changesへの対応
  - マイグレーションガイドに従う
  - テストを実行しながら修正
- 動作確認
- mainにマージ

## メリット

1. **リスクの分散**: 問題の原因を特定しやすい
2. **段階的な学習**: Riverpodの変更を理解する時間を確保
3. **安全性の向上**: テストによる保護の下でアップデート可能
4. **レビュー容易性**: 各PRが小さく、レビューしやすい

## 想定スケジュール

- Phase 1: 1-2日
- Phase 2: 3-5日（テストの量による）
- Phase 3: 2-3日

合計: 約1-2週間

## 注意事項

- Phase 1完了後、Renovateが自動でRiverpodをアップデートしないよう設定が必要な場合がある
- Phase 2では、最低限カバーすべき範囲を明確にすること
- 各Phaseでmainへのマージ前に動作確認を徹底すること
