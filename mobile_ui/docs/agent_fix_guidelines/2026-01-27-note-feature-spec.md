# Note機能 仕様書

**作成日**: 2026-01-27

## 概要
ユーザーがリッチなテキストでメモを作成・管理できるNote機能を実装する。

## データ構造

### Note モデル
保存するデータ:
- **タイトル** (String): ノートのタイトル
- **本文** (String): Markdown形式で保存
- **タグ** (List<Tag>): 関連付けられたタグのリスト
- **作成日時** (DateTime): ノート作成日時
- **更新日時** (DateTime): 最終更新日時
- **日付** (DateTime, optional): カレンダー表示用の日付

### Tag モデル
- **名前** (String): タグ名
- **色** (Color, optional): タグの表示色

## リッチテキストエディタの選択肢

### 1. flutter_quill ⭐ おすすめ
- **pub.dev**: https://pub.dev/packages/flutter_quill
- **バージョン**: 11.5.0
- **ダウンロード数**: 120,952
- **いいね数**: 2,096
- **特徴**:
  - 最も人気のあるFlutter用リッチテキストエディタ
  - WYSIWYG (What You See Is What You Get) 
  - Android, iOS, Web, デスクトップ全対応
  - Delta形式で保存、Markdownへの変換が可能
  - 拡張機能が豊富 (画像・動画の埋め込みなど)
  - `delta_markdown` (0.8.0) や `markdown_quill` (4.3.0) パッケージでMarkdown変換
- **メリット**:
  - コミュニティが大きく、ドキュメントが充実
  - 安定した開発・メンテナンス
  - カスタマイズ性が高い
- **デメリット**:
  - Delta形式がデフォルトのため、Markdown変換に追加パッケージが必要

### 2. appflowy_editor
- **pub.dev**: https://pub.dev/packages/appflowy_editor
- **バージョン**: 6.2.0
- **ダウンロード数**: 4,152
- **いいね数**: 496
- **特徴**:
  - AppFlowyプロジェクトの一部
  - 高度にカスタマイズ可能
  - ブロックベースのエディタ
- **メリット**:
  - モダンでリッチなUI
  - 積極的に開発されている
- **デメリット**:
  - ライセンスがMPL-2.0とAGPL-3.0の複合（商用利用時要確認）
  - Markdownサポートは完全ではない可能性

### 3. fleather
- **pub.dev**: https://pub.dev/packages/fleather
- **バージョン**: 1.26.0
- **ダウンロード数**: 7,551
- **いいね数**: 183
- **特徴**:
  - ミニマルでコラボレーション対応
  - Quillベース
  - 多言語対応 (日本語含む)
- **メリット**:
  - クリーンなコードベース
  - pub pointsが満点 (160/160)
- **デメリット**:
  - flutter_quillほど人気がない
  - Markdown変換のサポートが不明確

### 4. docsy
- **pub.dev**: https://pub.dev/packages/docsy
- **バージョン**: 0.1.1
- **ダウンロード数**: 17
- **いいね数**: 5
- **特徴**:
  - モジュラーなWYSIWYGエディタエンジン
  - JSON, Markdown, HTMLのインポート・エクスポート対応
- **メリット**:
  - Markdown, HTML, JSON形式をネイティブサポート
- **デメリット**:
  - まだ初期段階 (v0.1.1)
  - コミュニティが小さい

## 推奨ソリューション

**flutter_quill + delta_markdown** の組み合わせを推奨:

### 理由
1. **実績**: 最も使われているFlutter用リッチテキストエディタ
2. **Markdownサポート**: `delta_markdown`パッケージで簡単にMarkdown変換可能
3. **安定性**: 大規模なコミュニティとアクティブなメンテナンス
4. **拡張性**: 必要に応じて画像・動画埋め込みなど追加可能
5. **ライセンス**: MITライセンスで商用利用も安心

### 必要なパッケージ
```yaml
dependencies:
  flutter_quill: ^11.5.0
  delta_markdown: ^0.8.0  # またはmarkdown_quill: ^4.3.0
```

## 機能要件

### 基本機能
- [ ] タイトル入力
- [ ] リッチテキスト編集 (太字、斜体、リスト、見出しなど)
- [ ] Markdown形式での保存
- [ ] タグの追加・削除
- [ ] 作成日時・更新日時の自動記録

### 下書き・更新機能
**方針**: シンプルな更新機能を採用
- 自動保存機能 (一定時間ごと、または編集終了時)
- 「下書き」状態を持たせず、常に更新可能な仕様
- 削除機能で不要なノートを削除

**理由**: UXが明確で実装がシンプル

### カレンダー連携
- Noteに日付を設定可能
- Homeのカレンダーにノートを表示
  - 日付別にノート一覧を表示
  - カレンダーのセルにノートのインジケーター表示

## UI/UX設計

### 画面構成
1. **ノート一覧画面**
   - ノート一覧 (タイトル、更新日時、タグ)
   - タグでフィルタリング機能
   - 新規作成ボタン

2. **ノート編集画面**
   - タイトル入力フィールド
   - リッチテキストエディタ (flutter_quill)
   - タグ選択UI
   - 日付選択 (カレンダー連携用)
   - 保存・削除ボタン

3. **Home画面 (既存に追加)**
   - カレンダーの日付にノートアイコン表示
   - 日付タップでその日のノート一覧表示

## データ永続化

### ストレージ方式
- ローカルストレージ: `shared_preferences` (既存使用中)
  - または `sqflite` (将来的にデータ量が増えた場合)
- クラウド同期: 将来的な拡張として検討

### データ形式
```json
{
  "id": "uuid",
  "title": "ノートのタイトル",
  "content": "# Markdown形式の本文\n...",
  "tags": ["タグ1", "タグ2"],
  "createdAt": "2026-01-27T09:00:00Z",
  "updatedAt": "2026-01-27T10:30:00Z",
  "date": "2026-01-27"  // optional
}
```

## 実装順序

### Phase 1: 基本機能
1. Noteモデル・Tagモデルの作成
2. flutter_quillの導入と基本エディタ実装
3. Markdown変換機能の実装
4. ローカルストレージへの保存・読み込み

### Phase 2: UI実装
1. ノート一覧画面
2. ノート編集画面
3. タグ管理UI

### Phase 3: カレンダー連携
1. Noteに日付フィールド追加
2. Home画面のカレンダーにノート表示
3. 日付別ノート一覧表示

## 未決定事項・今後の検討項目

- [ ] タグの色管理方法
- [ ] ノートの検索機能
- [ ] ノートの並び替え (作成日順、更新日順、タイトル順など)
- [ ] 画像・動画の埋め込み対応の要否
- [ ] エクスポート機能 (Markdown/PDF)
- [ ] クラウド同期の実装時期

## 参考リンク
- [flutter_quill GitHub](https://github.com/singerdmx/flutter-quill/)
- [delta_markdown pub.dev](https://pub.dev/packages/delta_markdown)
- [markdown_quill pub.dev](https://pub.dev/packages/markdown_quill)
